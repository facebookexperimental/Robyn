<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-features" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Key Features | Robyn</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://facebookexperimental.github.io/Robyn/docs/features"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Key Features | Robyn"><meta data-rh="true" name="description" content="An in-depth discussion of both the implementation and technical underpinnings of Robyn follows."><meta data-rh="true" property="og:description" content="An in-depth discussion of both the implementation and technical underpinnings of Robyn follows."><link data-rh="true" rel="icon" href="/Robyn/img/robyn_logo.png"><link data-rh="true" rel="canonical" href="https://facebookexperimental.github.io/Robyn/docs/features"><link data-rh="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/features" hreflang="en"><link data-rh="true" rel="alternate" href="https://facebookexperimental.github.io/Robyn/docs/features" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-TMZK4YFDGL","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-TMZK4YFDGL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TMZK4YFDGL",{anonymize_ip:!0})</script><link rel="stylesheet" href="/Robyn/assets/css/styles.4f8b4048.css">
<link rel="preload" href="/Robyn/assets/js/runtime~main.aa789c18.js" as="script">
<link rel="preload" href="/Robyn/assets/js/main.4baa0a5c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.facebook.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Robyn/"><div class="navbar__logo"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Robyn</b></a><a class="navbar__item navbar__link" href="/Robyn/docs/welcome/">Documentation</a><a class="navbar__item navbar__link" href="/Robyn/docs/installation/">Getting Started</a><a class="navbar__item navbar__link" href="/Robyn/docs/case-studies">Case Studies</a><a class="navbar__item navbar__link" href="/Robyn/docs/resources">Resources</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/welcome">Welcome to Robyn</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Robyn/docs/installation">Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/analysts-guide-to-MMM">An Analyst&#x27;s Guide to MMM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Robyn/docs/features">Key Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/robyn-api">Robyn API for Python</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/case-studies">Case Studies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Robyn/docs/resources">Resources</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Robyn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Key Features</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Key Features</h1></header><p>An in-depth discussion of both the implementation and technical underpinnings of Robyn follows.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-inputs">Model Inputs<a href="#model-inputs" class="hash-link" aria-label="Direct link to Model Inputs" title="Direct link to Model Inputs">â€‹</a></h2><p>The function <code>robyn_inputs()</code> mainly captures all model specification for the dataset. Here we break down some of the underlying concepts</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">InputCollect &lt;- robyn_inputs(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dt_input = dt_simulated_weekly</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dt_holidays = dt_prophet_holidays</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,date_var = &quot;DATE&quot; # date format must be &quot;2020-01-01&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dep_var = &quot;revenue&quot; # there should be only one dependent variable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,dep_var_type = &quot;revenue&quot; # &quot;revenue&quot; or &quot;conversion&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,prophet_vars = c(&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;) # &quot;trend&quot;,&quot;season&quot;, &quot;weekday&quot; &amp; &quot;holiday&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,prophet_country = &quot;DE&quot;# select only one country</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,context_vars = c(&quot;competitor_sales_B&quot;, &quot;events&quot;) # e.g. competitors, discount, unemployment etc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,paid_media_spends = c(&quot;tv_S&quot;,&quot;ooh_S&quot;,&quot;print_S&quot;,&quot;facebook_S&quot;, &quot;search_S&quot;) # Media spend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,paid_media_vars = c(&quot;tv_S&quot;, &quot;ooh_S&quot;,&quot;print_S&quot;,&quot;facebook_I&quot;,&quot;search_clicks_P&quot;) # Media exposure metrics. Use the same as paid_media_spends if not available</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,organic_vars = c(&quot;newsletter&quot;) # marketing activity without media spend</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,factor_vars = c(&quot;events&quot;) # specify which variables in context_vars or organic_vars are factorial</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,window_start = &quot;2016-01-01&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,window_end = &quot;2018-12-31&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ,adstock = &quot;geometric&quot; # geometric, weibull_cdf or weibull_pdf.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paid-media-variables">Paid Media Variables<a href="#paid-media-variables" class="hash-link" aria-label="Direct link to Paid Media Variables" title="Direct link to Paid Media Variables">â€‹</a></h3><p>Refer to the <a href="https://facebookexperimental.github.io/Robyn/docs/analysts-guide-to-MMM#data-collection" target="_blank" rel="noopener noreferrer">Data Collection</a> section of the Analyst&#x27;s Guide to MMM for a detailed discussion on best practices for selecting your paid media variables.</p><p>For paid media variables, we currently require that users designate both <code>paid_media_vars</code> and <code>paid_media_spends</code>. <code>paid_media_vars</code> refers to media exposure metrics, e.g. TV GRP, search clicks or Facebook impressions. <code>paid_media_spends</code> refers to media spending. The two vectors must have the same length and the same order of media. When exposure metrics are not available, use the same as in <code>paid_media_spends</code>.</p><p><strong>Note</strong>: Robyn currently fits the main model using only media spend. Exposure as modeling varibale is deprecated due to the uncertainty it introduces to the budget allocation. Robyn uses the Michaelis-Menten function to translate between spend and exposure. Despite the nonlinear flexibility this function provides, the relationship between spend and exposure is often too complex for a univariate transformation. In earlier versions, this inaccuracy in spend-exposure translation has caused unreliable budget allocation. Even though we understand the narrative of using exposure metrics, we&#x27;ve decided to trade it off against the reliability of budget allocation. We&#x27;ll re-introduce exposure fitting as soon as we have a working solution.</p><p>Despite the deprecation mentioned above, there&#x27;s still value in providing exposure metrics in Robyn. If there&#x27;s weak association detected between spend &amp; exposure, it indicates that exposure metrics have different underlying pattern than spends. In this case, Robyn will recommend to splitting the channel for potentially better modeling result. Take Meta as example, retargeting and prospecting campaigns might have very different CPMs and efficiencies. In which case, it would be meaningful to split Meta by retargeting and prospecting.</p><p>In general, it&#x27;s important to ensure that the paid media data is complete and accurate before proceeding. We will talk more about the variable transformations paid media variables will be subject to in the Variable Transformation section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="organic-variables">Organic Variables<a href="#organic-variables" class="hash-link" aria-label="Direct link to Organic Variables" title="Direct link to Organic Variables">â€‹</a></h3><p>Robyn enables users to specify <code>organic_vars</code> to model marketing activities without direct spend. Typically, this may include newsletter, push notification, social media post stats, among others. Moreover, organic variables are expected to have carryover (adstock) and saturating behavior as paid media variables. The respective transformation techniques are also applied to organic variables. More on these transformations in the following section.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="examples-of-typical-organic-variables">Examples of typical organic variables<a href="#examples-of-typical-organic-variables" class="hash-link" aria-label="Direct link to Examples of typical organic variables" title="Direct link to Examples of typical organic variables">â€‹</a></h4><ul><li>Reach / impressions on blog posts</li><li>Impressions on organic &amp; unpaid social media</li><li>SEO improvements</li><li>Email campaigns</li><li>Reach on UGC</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="contextual-variables">Contextual Variables<a href="#contextual-variables" class="hash-link" aria-label="Direct link to Contextual Variables" title="Direct link to Contextual Variables">â€‹</a></h3><p>All contextual variables must be specified as elements in <code>context_vars</code>. For a detailed discussion on potential contextual variables to include in your model, see the <a href="https://facebookexperimental.github.io/Robyn/docs/analysts-guide-to-MMM#data-collection" target="_blank" rel="noopener noreferrer">Data Collection</a> section of the Analyst&#x27;s guide to MMM.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-demand-map">The &quot;demand map&quot;<a href="#the-demand-map" class="hash-link" aria-label="Direct link to The &quot;demand map&quot;" title="Direct link to The &quot;demand map&quot;">â€‹</a></h3><p>A demand map is a very helpful practise to identify all relevant factors influencing our business performance. It&#x27;s strongly recommended to do this exercise, esp. when running MMM for the first time. It&#x27;s also helpful to revisit your hypothesis regularly.</p><img loading="lazy" alt="organic media" src="/Robyn/img/organic-media.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variable-transformations">Variable Transformations<a href="#variable-transformations" class="hash-link" aria-label="Direct link to Variable Transformations" title="Direct link to Variable Transformations">â€‹</a></h2><p>MMM is typlically characterised by the following two hypothesis:</p><ol><li>Ads investment has lagged effect / carries over through time. For example, I see ads today and buy next week.</li><li>Ads investment has diminishing returns. For example, the more I spent on a channel, the less marginal return I will get.</li></ol><p>Robyn conducts two types of transformation to account for these hypothesis:</p><ol><li>Adstock transformation</li><li>Saturation transformation</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adstock">Adstock<a href="#adstock" class="hash-link" aria-label="Direct link to Adstock" title="Direct link to Adstock">â€‹</a></h3><p>Adstock refers to the hypothesis of ads carryover and reflects the theory that the effects of advertising can lag and
decay following initial exposure. It&#x27;s also related to certain brand equity metrics like ad-recall or campaign awareness. The logical narrative is &quot;I saw the ads X days ago before I bought the product&quot;. Usually, it&#x27;s assumed that this &quot;memory&quot; decays as time passes. But there&#x27;re also cases when it&#x27;s legitimate to assume that the effect of this &quot;memory&quot; will increase first before decreasing. For example, expensive products like cars or credits are unlikely to be purchased directly after the ads, esp. for offline channels. Therefore, it&#x27;s usual to assume lagged effect with later peaks for offline channels for these products. At the same time, online conversions from digital channels might be suitable without lagged peaks and only deal with decay.</p><p>The formula for adstock can be generalised as:</p><p><code>media_adstocked_i = media_raw_i + decay_rate *  media_raw_i-1</code>, where <code>i</code> is a given time period.</p><p>There are three adstock transformation options you can choose in Robyn:</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="geometric">Geometric<a href="#geometric" class="hash-link" aria-label="Direct link to Geometric" title="Direct link to Geometric">â€‹</a></h4><p>The one-parametric exponential decay function is used with theta as the fixed-rate decay parameter. For example, an adstock of <code>theta = 0.75</code> means that 75% of the ads in Period 1 carryover to Period 2. Robyn&#x27;s implementation of Geometric transformation can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/transformation.R#L57" target="_blank" rel="noopener noreferrer">here</a> and is shown conceptually as followed:</p><p><code>media_adstocked_ij = media_raw_ij + decay_rate_j *  media_raw_i-1_j</code>, where <code>i</code> is a given time period and <code>j</code> depicts a media variable. The <code>decay_rate_j</code> is a constant value per media variable and equal to the Geometric parameter <code>theta</code>.</p><p>Some rule of thumb estimates we have found from historically building weekly-level models are that  TV has tended to have adstock between 0.3 - 0.8, OOH/Print/Radio has had 0.1-0.4, and Digital has had 0.0 - 0.3. This is anecdotal advice so please use your best judgement when building your own models.</p><img loading="lazy" alt="Example Geometric Adstocks" src="/Robyn/img/adstockintro.png" class="img_ev3q"><p>Another useful property of Geometric decay is that the limit of the inifinite sum is equal to <code>1 / (1 - theta)</code>. For example, when <code>theta = 0.75</code>, its infinite sum is <code>1 / (1 - 0.75) = 4</code>. Because Robyn conducts adstock transformation on spends, it can give you a quick and inituitive idea of how much &quot;inflation&quot; the adstock transformation will add on your raw data. On the other hand, Geometric decay is not able to capture more flexible time-varying decay, nor the lagging effect, which are solved by the Weibull adstock below.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="weibull-pdf--cdf">Weibull PDF &amp; CDF<a href="#weibull-pdf--cdf" class="hash-link" aria-label="Direct link to Weibull PDF &amp; CDF" title="Direct link to Weibull PDF &amp; CDF">â€‹</a></h4><p>Robyn offers the two-parametric Weibull function in the formats of PDF and CDF. Compared to the one-parametric Geometric function where theta is equal to the fixed decay rate, Weibull produces a vector of time-varying decay rates through more flexibility in the transformation with the parameters <code>shape</code> and <code>scale</code>. Robyn&#x27;s implementation of Weibull transformation can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/transformation.R#L128" target="_blank" rel="noopener noreferrer">here</a> and is shown conceptually as followed:</p><p><code>media_adstocked_ij = media_raw_ij + decay_rate_ij *  media_raw_i-1_j</code>, where <code>i</code> is a given time period and <code>j</code> depicts a media variable. Note that the <code>decay_rate_ij</code> specific to time period <code>i</code> of the media variable <code>j</code>, compared to the fixed decay rate from Geometric.</p><p>The plot below shows the flexibility of Weibull adstocks with regard to the two parameters <code>shape</code> and <code>scale</code>. This flexibility does come at a cost of more computational power due to the extra hyperparameters. <strong>Weibull PDF is strongly recommmended for products with longer conversion window.</strong> We&#x27;ve seen Weibulll PDF leading to considerabaly better fit in some cases.</p><img loading="lazy" alt="Example Weibull Adstocks" width="800" src="/Robyn/img/weibulladstocks.png" class="img_ev3q"><p> <strong>Weibull CDF adstock:</strong> The Cumulative Distribution Function of Weibull has two parmeters
<code>shape</code> &amp; <code>scale</code> that enables flexible decay rate, compared to Geometric adstock with fixed
decay rate. The <code>shape</code> parameter controls the curvature of the decay curve. Recommended
bound is <code>c(0.0001, 2)</code>. The larger the shape, the more S-form the curve becomes. The smaller
the shape, the more L-form. <code>scale</code> controls the inflexion point of the curve. We recommend
very conservative bounce of <code>c(0, 0.1)</code>, because scale increases the adstock half-life greatly.</p><p><strong>Weibull PDF adstock:</strong> The Probability Density Function of the Weibull also has two
parameters, <code>shape</code> &amp; <code>scale</code>, and also provides flexible decay rate as Weibull CDF. The
difference is that Weibull PDF offers lagged effect. When <code>shape &gt; 2</code>, the curve peaks
after x = 0 and has NULL slope at x = 0, enabling lagged effect and sharper increase and
decrease of adstock, while the scale parameter indicates the limit of the relative
position of the peak at x axis; when <code>1 &lt; shape &lt; 2</code>, the curve peaks after x = 0 and has
infinite positive slope at x = 0, enabling lagged effect and slower increase and decrease
of adstock, while scale has the same effect as above; when <code>shape = 1</code>, the curve peaks at
x = 0 and reduces to exponential decay, while scale controls the inflexion point; when
<code>0 &lt; shape &lt; 1</code>, the curve peaks at x = 0 and has increasing decay, while scale controls
the inflexion point. When all possible shapes are relevant, we recommend <code>c(0.0001, 10)</code>
as bounds for <code>shape</code>; when only strong lagged effect is of interest, we recommend
<code>c(2.0001, 10)</code> as bound for <code>shape</code>. In all cases, we recommend conservative bound of
<code>c(0, 0.1)</code> for <code>scale</code>. Due to the great flexibility of Weibull PDF, meaning more freedom
in hyperparameter spaces for Nevergrad to explore, it also requires larger iterations
to converge.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saturation">Saturation<a href="#saturation" class="hash-link" aria-label="Direct link to Saturation" title="Direct link to Saturation">â€‹</a></h3><p>The theory of diminishing returns (also called saturation) holds that each additional
unit of advertising investment increases the response at a declining rate. This
hypothesis is implemented as variable transformation in marketing mix models.</p><img loading="lazy" alt="Diminishing returns1" src="/Robyn/img/diminishingreturns1.png" class="img_ev3q"><p>The nonlinear response to a media variable on the dependent variable can be
modelled in different ways. Common approaches include transforming the media variable
by the logarithm transformation, the power transformation or any sigmoid-shape
functions. A common trait of these transformation is that they are all continuous
and differentiable, which is important for the budget allocation with any nonlinear
optimisation algorithms.</p><p>Robyn uses the latter and implements the Hill function for a flexible
transformation into S- or L-shape saturation. The implementation of Hill function
in Robyn can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/transformation.R#L210" target="_blank" rel="noopener noreferrer">here</a>
and is shown conceptually as followed:</p><p><code>media_saturated_j = 1 / (1 + (gamma_j / media_adstocked_j) ^ alpha_j)</code>, where
<code>j</code> depicts a media variable.</p><p>Note that <code>gamma_j</code> above is scaled to the inflexion point of the variable. By
varying the values of <code>alpha</code> and <code>gamma</code>, changes in curvature and inflexion point
of the saturation curve can be observed below:</p><img loading="lazy" alt="Diminishing returns1" src="/Robyn/img/diminishingreturns3.png" class="img_ev3q"><p>In this plot, x axis depicts spend and y response. <code>alpha</code> controls the shape of
the curve between C- and S-shape. Recommended bound for <code>alpha</code> is <code>c(0.5, 3)</code>.
The larger the alpha, the more S-shape. The smaller, the more C-shape. <code>gamma</code>
controls the inflexion point of the curve. Recommended bounce of <code>gamma</code> is
<code>c(0.3, 1)</code>. The larger the gamma, the later the inflection point in the response
curve.</p><p>Another important term that&#x27;s related to saturation is the marginal response. In
mathematical term, the marginal response is equal to the first derivative of a given
point at the nonlinear curve. In layman&#x27;s term, it&#x27;s the &quot;next dollar response&quot; on
a given spend level. For example, if the average weekly spend is 1000$, &quot;what is the
return from the 1001th dollar?&quot; This is the foundation of understanding how nonlinear
budget allocation works. For more details in marginal response, see <strong><a href="https://medium.com/@gufengzhou/the-convergence-of-marginal-roas-in-the-budget-allocation-in-robyn-5d407aebf021" target="_blank" rel="noopener noreferrer">this article</a>: &quot;The convergence
of marginal ROAS in the budget allocation in Robyn&quot;</strong>.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="trend--seasonality-decomposition-with-prophet">Trend &amp; seasonality decomposition with Prophet<a href="#trend--seasonality-decomposition-with-prophet" class="hash-link" aria-label="Direct link to Trend &amp; seasonality decomposition with Prophet" title="Direct link to Trend &amp; seasonality decomposition with Prophet">â€‹</a></h2><p>As for any real-life time-series problems, it&#x27;s fundamental to understand trend
and seasonality in the data for better fitting. In conventional MMM, this is often
done separately and manually using simple assumptions like linear trend or dummy
variable for seasonality. With the purpose of reducing human bias in the modeling
process, Robyn provides trend, season, holiday &amp; weekday decomposition out of the
box using Prophet, a popular time-series forecast package by Meta. In many cases,
this has proven to be increasing the model fit greatly. More details on how time-series
decomposition works can be found in <a href="https://facebook.github.io/prophet/docs/trend_changepoints.html" target="_blank" rel="noopener noreferrer">Prophet&#x27;s documentaion</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exemplary-time-series-decomposition">Exemplary time-series decomposition<a href="#exemplary-time-series-decomposition" class="hash-link" aria-label="Direct link to Exemplary time-series decomposition" title="Direct link to Exemplary time-series decomposition">â€‹</a></h3><p>In the plot below, the dependent variable &quot;revenue&quot; from Robyn&#x27;s weekly <a href="https://github.com/facebookexperimental/Robyn/tree/main/R/data" target="_blank" rel="noopener noreferrer">sample data</a> is decomposed into trend, season and holiday components. Note that
weekday is not included because it&#x27;s only available for daily data. Note that the &quot;event&quot;
variable is included as an extra regressor. With this, Robyn &quot;converts&quot; a categorical
variable to a continuous one, which simplifies later calculation.</p><img loading="lazy" alt="prophet 2" src="/Robyn/img/prophet_decomp.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ridge-regression">Ridge Regression<a href="#ridge-regression" class="hash-link" aria-label="Direct link to Ridge Regression" title="Direct link to Ridge Regression">â€‹</a></h2><p>Marketing Mix Models often encounter the multicollinear issue, because it is a
common business practise to operate on different media channels at the same time
(e.g. increasing spends on all channels over Christmas). In other words, multicollinearity
occurs when more than one independent variables are correlated in a regression
model. It results in unstable coefficient estimates, difficulty in interpretation
of the coefficient significance as well as overfitting.</p><p>Regularised regression is a common choice to counter the challenges of multicollinearity
mentioned above. Robyn uses the L2-form of the regularisation, also known as Ridge
regression. We&#x27;ve decided for Ridge instead of Lasso (L1-form) regression, because
Lasso tends to eliminate features (&quot;zero-out&quot;) while Ridge rather reduces their
magnitude. For MMM, it&#x27;s unrealistic to have many media variables having zero effect.</p><p>Robyn uses the package <code>glmnet</code> to perform the regularised regression fitting.
The implementation can be found <a href="https://github.com/facebookexperimental/Robyn/blob/main/R/R/model.R#L1047" target="_blank" rel="noopener noreferrer">here</a>.
The loss function for Ridge regression is as followed:</p><img loading="lazy" alt="Ridge Regression Formula" src="/Robyn/img/Ridge.png" class="img_ev3q"><p>The additive model equation is as followed:</p><img loading="lazy" alt="Ridge Regression Formula" src="/Robyn/img/model_specification.png" class="img_ev3q"><p>A popular question about our model choice is &quot;why not use a Bayesian model&quot;. The Bayesian
framework has seen rising popularity for business implementations, especially because
of many of its attractive properties like the Bayesian prior as a native model calibration
feature and the intuitive interpretation of the Bayesian credible interval.</p><p>We want to point out that Ridge regression is equivilent to a Bayesian regression with a
normal / Gaussian prior, while Lasso corresponds to the Bayesian Laplace prior. This
is a well-studied fact academically, for example in the paragraph <strong>&quot;Bayesian Interpretation of
Ridge Regression and the Lasso&quot;</strong> on page 249 in <a href="https://hastie.su.domains/ISLR2/ISLRv2_corrected_June_2023.pdf" target="_blank" rel="noopener noreferrer">&quot;An Introduction
to Statistical Learning&quot;</a>
by T.Hastie and co.</p><p>Robyn uses an multi-objective algorithm as the optimisation approach,because we
believe that the problem a MMM tries to solve has multiple goals. It&#x27;s often said
that MMM is both science and craft. The model is expected to both predict well and
&quot;makes sense&quot;. From this angle, it&#x27;s very natural to consider this a multi-objective
optimisation problem. Regularised regression has a better fit to our optimizer choice
(TwoPointsDE, an evolutionary algorithm from Nevergrad), because the (hyper)parameters
are estimated with many evolutionary iterations, as opposed to the typical sampling
process with MCMC in a Bayesian regression. More details about multi-objective
optimisation and Nevergrad see below.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multi-objective-hyperparameter-optimization-with-nevergrad">Multi-Objective Hyperparameter Optimization with Nevergrad<a href="#multi-objective-hyperparameter-optimization-with-nevergrad" class="hash-link" aria-label="Direct link to Multi-Objective Hyperparameter Optimization with Nevergrad" title="Direct link to Multi-Objective Hyperparameter Optimization with Nevergrad">â€‹</a></h2><p>Every MMM practitioner knows this &quot;sanity check&quot;: When facing multiple model candidates, it&#x27;s common to prefer a model that&#x27;s more &quot;plausible&quot;, meaning one with slightly less fit but better alignment with current spend allocation. For example, for a dataset with 2 channels splitting 90%/10% media spend, a model that produces the contribution of 10%/90% is considered rather implausible, no matter how good the model fit is. In comparison, another model with 70%/30% contribution split would be considered more pausible.</p><p>In other words, a good MMM needs to be both predictive and interpretable. This is the frequently cited conflict of science and craft. At team Robyn, we considered this a multi-objective optimisation problem, because the reality is never simply prediction. We believe it&#x27;s important to include the &quot;sanity check&quot; into the optimisation through parameterization in the form of extra objective functions. <strong>The implementation of multi-objective hyperparameter optimization is considered the most important innovation in Robyn.</strong> At the same time, the usage of hyperparameters enables stronger automation of the parameter selection for adstocking, saturation, regularization penalty and even training size of time-series validation.</p><p>Robyn uses <a href="https://facebookresearch.github.io/nevergrad/" target="_blank" rel="noopener noreferrer"><strong>Nevergrad</strong></a>, Metaâ€™s gradient-free optimization platform to perform this task with its so-called &quot;ask &amp; tell&quot;&quot; interface. Simply explained, Robyn &quot;asks&quot; Nevergrad for the mutating hyperparameter values by &quot;telling&quot; it which values have better scores (objective functions).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="objective-functions">Objective Functions<a href="#objective-functions" class="hash-link" aria-label="Direct link to Objective Functions" title="Direct link to Objective Functions">â€‹</a></h3><p>Robyn implements three objective functions as the &quot;goals&quot; for hyperparameter optimisation currently.</p><ul><li><strong>NRMSE</strong>: The Normalized Root Mean Square Error is also referred to as the <strong>prediction error</strong>. Robyn allows time-series validation with the spitting of the dataset into train / validation / test. When fitting without the time-series validation, the training error <code>nrmse_train</code> is objective function for the evolving iterations. With time-series validation, the validation error <code>nrmse_val</code> becomes the objective function, while <code>nrmse_test</code> is used to assess the out-of-sample preditive performance.</li><li><strong>DECOMP.RSSD</strong>: The Decomposition Root Sum of Squared Distance is also referred to as the <strong>business error</strong> and is a key invention of Robyn. It represents the difference between share of spend and share of effect for paid media variables. We&#x27;re aware that this metric is controvertial because of the convergence of media ROAS. In the reality, multiple objectives always &quot;work together&quot; and trade off each other in the optimisation process. DECOMP.RSSD rules out models with extreme decomposition and helps narrowing down model selection.</li><li><strong>MAPE.LIFT</strong>: The Mean Absolute Percentage Error for experiments is activated when calibrating and is referred to as the <strong>calibration error</strong>. It&#x27;s a key invention of Robyn and allows Robyn to minimise the difference between predicted effect and causal effect.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hyperparameters">Hyperparameters<a href="#hyperparameters" class="hash-link" aria-label="Direct link to Hyperparameters" title="Direct link to Hyperparameters">â€‹</a></h3><p>There&#x27;re four types of hyperparameters in Robyn at the moment.</p><ul><li><strong>Adstocking</strong>: <code>theta</code> when selecting Geometric adstocking, or <code>shape</code> &amp; <code>scale</code> when selecting Weibull adstocking</li><li><strong>Saturation</strong>: <code>alpha</code> &amp; <code>gamma</code> for Hill function</li><li><strong>Regularization</strong>: <code>lambda</code> for the penalty term in ridge regression</li><li><strong>Validation</strong>: <code>train_size</code> for the percentage of training data</li></ul><p>The cardinality of hyperparameters increases when adding more paid and organic media variables, because Robyn performs adstocking &amp; saturation transformation for each media variable individually. For example, if using 10 media variables with Geometric adstock, the total amount of hyperparameters is 32: 10 thetas + 10 alphas + 10 gammas + 1 lambda + 1 train_size. With Weibull adstock, it&#x27;s 42: 10 shapes + 10 scales + 10 alphas + 10 gammas + 1 lambda + 1 train_size. Adding hyperparameters will give Robyn more flexibility to find optimum solutions, but it will trade-off model runtime because it needs longer to converge.</p><p>Using the concept of <a href="https://en.wikipedia.org/wiki/Pareto_efficiency" target="_blank" rel="noopener noreferrer"><strong>Pareto-optimality</strong></a> balancing all objective functions, Robyn always outputs a set of pareto-optimum model candidates that are considered &quot;the best&quot;. Please find below an example of an example chart of the Pareto model solutions.
Each dot in the chart represents an explored model solution, while the lower-left corner lines are Pareto-fronts 1-3 and contains the best possible model results from all iterations.
The two axes (NRMSE on x and DECOMP.RSSD on y) are the two objective functions to be minimized.
As the iteration increases, a trend down the lower-left corner of the coordinate can be clearly observed.
This is a proof of Nevergrad&#x27;s ability to drive the model result towards an optimal direction.</p><img loading="lazy" alt="pareto chart" src="/Robyn/img/pareto_front.png" class="img_ev3q"><p>The premise of an <strong>evolutionary algorithm</strong> is that of natural selection. In an evolutionary algorithm you may have a set of iterations where some combinations of coefficients that will be explored by the model will survive and proliferate, while unfit models will die off and not contribute to the gene pool of further generations, much like in natural selection.
In robyn, we recommend a minimum of 2000 iterations where each of these will provide feedback to its upcoming generation, and therefore guide the model towards the optimal coefficient values for alphas, gammas and thetas. We also recommend a minimum of 5 trials which are a set of independent initiations of the model that will each of them have the number of iterations you set under â€˜set_iterâ€™ object. E.g. 2000 iterations on set_iter x 5 trials = 10000 different iterations and possible model solutions.</p><p>In Robyn, we consider the model to be converged <strong> UNDER REVISION </strong> when:</p><p>Criteria #1:
Last quantile&#x27;s standard deviation &lt; first 3 quantiles&#x27; mean standard deviation</p><p>Criteria #2:
Last quantile&#x27;s absolute median &lt; absolute first quantile&#x27;s absolute median - 2 * first 3 quantiles&#x27; mean standard deviation</p><p>The quantiles are ordered by the iterations of the model, so if we ran 1000 iterations, the first 200 iterations would make up the first quantile. These two criteria represent an effort to demonstrate that both the standard deviation and the mean for both NRMSE and DECOMP.RSSD have improved relative to where they began, and they are not as variable.</p><p>Alternatively, run the following code to observe the convergence of your multi-objective optimization in the ridgeline visualization.</p><p><code>OutputModels$convergence$moo_distrb_plot</code></p><img loading="lazy" alt="moo cloud plot" src="/Robyn/img/moo_cloud_plot.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="time-series-validation">Time Series Validation<a href="#time-series-validation" class="hash-link" aria-label="Direct link to Time Series Validation" title="Direct link to Time Series Validation">â€‹</a></h2><p>When <code>ts_validation = TRUE</code> in <code>robyn_run()</code> a 3-way-split time series for NRMSE validation is enabled.
A time series validation parameter <code>train_size</code> is included as one of Robyn&#x27;s hyperparameters. When <code>ts_validation = TRUE</code> in <code>robyn_run()</code>, <code>train_size</code> defines the percentage of data used for training, validation and out-of-sample testing. For example, when <code>train_size = 0.7</code>, <code>val_size</code> and <code>test_size</code> will be 0.15 each. This hyperparameter is customizable or can be fixed with a default range of <code>c(0.5, 0.8)</code> and must be between <code>c(0.1, 1)</code>.</p><img loading="lazy" alt="time series validation" src="/Robyn/img/time_series_validation_and_convergence.png" class="img_ev3q"><img loading="lazy" alt="time series validation" src="/Robyn/img/actual_vs_predicted_response_ts.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-clustering">Model Clustering<a href="#model-clustering" class="hash-link" aria-label="Direct link to Model Clustering" title="Direct link to Model Clustering">â€‹</a></h2><p>As depicted in plot 4 in <a href="#model-onepager">session model onepager</a> below, the k-means clustering is used to further reduce model choice. Robyn uses bootstrapping to calculate uncertainty of ROAS or CPA.</p><ul><li>Use k-means clustering on all pareto-optimal model candidates to find clusters of models with similar hyperparameters. The constant k describes the number of clusters.</li><li>When <code>k = &quot;auto&quot;</code> (default value), WSS (Within Group Sum of Squares) is calculated to automatically find the best k value between 1-20. The k value with &lt;5% WSS change from the previous k is selected. This is visualised in the screenshot below.</li><li>Within each of the k clusters, a winner model is selected based on the three normalised objective functions (NRMSE, DECOM.RSSD, and MAPE if calibrated was used).</li><li>In the context of <a href="#multi-objective-hyperparameter-optimization-with-nevergrad">MOO</a>, we consider each cluster a sub-population in a different local optimum.</li></ul><img loading="lazy" alt="Pareto clusters WSS" src="/Robyn/img/pareto_clusters_wss.png" class="img_ev3q"><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="calibration-with-causal-experiments">Calibration with causal experiments<a href="#calibration-with-causal-experiments" class="hash-link" aria-label="Direct link to Calibration with causal experiments" title="Direct link to Calibration with causal experiments">â€‹</a></h2><p>Randomised controlled trial (RCT) is an established academic gold standard to infer causality in science. By applying results from RCT in ads measurement that are considered ground truth, you can introduce causality into your marketing mix models. Robyn implements the MMM calibration as an objective function in the multi-objective optimization by parameterizing the difference between causal results and predicted media contribution.</p><img loading="lazy" alt="Calibration chart" src="/Robyn/img/calibration1.png" class="img_ev3q"><p>The chart above illustrates the calibration concept. The calibration error <strong>MAPE.LIFT</strong> is implemented as the third objective function besides the prediction error and the business error (please refer to <a href="#multi-objective-hyperparameter-optimization-with-nevergrad">details above</a>) and depicts the difference between predicted media contribution and the ground truth, as shown in the equation in the chart.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="key-findings-of-calibration">Key findings of calibration<a href="#key-findings-of-calibration" class="hash-link" aria-label="Direct link to Key findings of calibration" title="Direct link to Key findings of calibration">â€‹</a></h3><ul><li>According to an third party whitepaper <a href="https://analytic-edge.com/blog/the-value-of-calibrating-mmm-with-lift-experiments/" target="_blank" rel="noopener noreferrer">&quot;The Value of Calibrating MMM with Lift Experiments&quot;</a> by Analytic Edge, <strong>uncalibrated models show 25% average difference to the ground truth</strong>.</li><li>Another <a href="https://medium.com/@gufengzhou/calibrated-mmm-better-predicts-true-roas-d5adfc8abdc4" target="_blank" rel="noopener noreferrer">simulated experiment</a> conducted by the the winners of the <a href="https://apac-robyn2022.devpost.com/" target="_blank" rel="noopener noreferrer">Robyn 2022 Hackathon</a> has found out that:<ul><li><strong>Calibrated models are better</strong>: All calibrated models show predicted ROAS closer to true ROAS with smaller MAPE than uncalibrated models.</li><li><strong>Good for one, good for all</strong>: When only calibrating one from both simulated channels (TV &amp; FB), the other channel also predicts better towards true ROAS than uncalibrated.</li><li><strong>The more calibrated channels, the better</strong>: Calibrating both simulated channels (TV &amp; FB) shows the lowest error to true ROAS. This is expected, because Robynâ€™s calibration is designed to recover the true ROAS by having the calibration error (MAPE.LIFT) as an objective function within Robynâ€™s multi-objective optimisation capacity.</li><li><strong>The more studies to calibrate, the better</strong>: The true ROAS prediction improves strongly with up-to 10 studies per channel.</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="types-of-experiments">Types of experiments<a href="#types-of-experiments" class="hash-link" aria-label="Direct link to Types of experiments" title="Direct link to Types of experiments">â€‹</a></h3><p>There&#x27;re two major types of experiements in ads measurement, as pointed out by this WARC article <a href="https://www.warc.com/content/paywall/article/a-step-by-step-guide-to-calibrating-marketing-mix-models-with-experiments/en-GB/152212" target="_blank" rel="noopener noreferrer">&quot;A step-by-step guide to calibrating marketing mix models with experiments&quot;</a>.</p><ul><li><strong>Sales experiments</strong>: These experiments aim to measure the impact of marketing activities on sales such as online conversion. Examples are <a href="https://www.facebook.com/business/m/one-sheeters/conversion-lift" target="_blank" rel="noopener noreferrer">Metaâ€™s Conversion Lift</a> or <a href="https://support.google.com/google-ads/answer/12003020?hl=en" target="_blank" rel="noopener noreferrer">Googleâ€™s Conversion Lift</a>. These experiments work by comparing the conversion rates between a test group and a control group, and help estimate the causal effect of marketing.<ul><li><strong>Pros</strong>: Provide direct insight into sales impact, relatively straightforward to plan and execute.</li><li><strong>Cons</strong>: Limited to measuring conversion-related outcomes, may overlook non-conversion effects. Only applicable to digital channels.</li></ul></li><li><strong>Geo experiments</strong>: Geo experiments analyze the impact of marketing activities in specific geographic regions such as DMAs, states or cities. By comparing the outcomes in regions exposed to marketing interventions with those in control regions, the spatial variation in response can be quantified.<ul><li><strong>Pros</strong>: Capture spatial variations and market-specific responses, useful for localized marketing. Possibility to run offline. Same test for cross channel. Can estimate groups of channels (e.g. all digital). Might even be applicable for offline channels like addressable TV or OOH.</li><li><strong>Cons</strong>: Could get affected by potential spillover effects across regions, requiring careful design to ensure comparability.</li></ul></li></ul><p>Robyn accepts a dataframe as calibration input in the <code>robyn_inputs()</code> function. The function usage can be found in the <a href="https://github.com/facebookexperimental/Robyn/blob/main/demo/demo.R#L262" target="_blank" rel="noopener noreferrer">demo</a>.</p><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-onepager">Model onepager<a href="#model-onepager" class="hash-link" aria-label="Direct link to Model onepager" title="Direct link to Model onepager">â€‹</a></h2><p>Robyn automatically exports various graphical and tabular outputs into the specified path to aid result interpretation and further custom analysis. An onepager per pareto-optimal model is exported after running the <code>robyn_outputs()</code> function. An example:</p><img loading="lazy" alt="ModelResults1 chart" src="/Robyn/img/modelresults2.png" class="img_ev3q"><ol><li><p><strong>Response decomposition waterfall:</strong> This chart depicts the absolute as well as percentage contribution of all of independent variables. The percentages sum up to 100% and can be interpreted as &quot;x% of the revenue can be explained by variable A&quot;. <strong>The concept &quot;baseline&quot;</strong> might come up in the context of total decomposition. While there&#x27;s no clear definition of baseline, we define baseline as &quot;non-steerable variables&quot;. All marketing-related variables (paid, organic, price, promotion etc.) are considered steerable. The rest of seasonal (trend, season, holiday etc.), external variables (competitors, weather etc.) and intercept are considered baseline.</p></li><li><p><strong>Actual vs. predicted response:</strong> This chart shows the actual response variable (e.g. revenue) vs. the predicted value from the model. The goodness of fit can be observed visually. In this example, the R-squared is considerably high (close to 0.9), while both actual and predicted lines are visually well aligned. Moreover, this plot helps the interpretation of &quot;unmatched events&quot;, e.g. the peak mid 2018 is not captured by the model at all. Was there a special event that&#x27;s not accounted for in the model?</p></li><li><p><strong>Share of spend vs. share of effect:</strong> This plot shows the comparison between the total effect share and total spend share for all paid media variables within the entire modeling window. This is the visualization of the objective function <a href="#objective-functions">DECOMP.RSSD</a>. Moreover, the total return on investment (ROAS) of each media variable are also plotted. Note that the percentage of effect will sum up to 100% for media variable only in this plot, as opposed to the waterfall plot that contains all variabes.</p></li><li><p><strong>In-cluster bootstrapped confidence interval</strong>: Robyn uses bootstrapping to calculate uncertainty of ROAS or CPA. After obtaining all pareto-optimal model candidates, the K-means clustering is applied to find clusters of models with similar hyperparameters. In the context of <a href="#multi-objective-hyperparameter-optimization-with-nevergrad">MOO</a>, we consider these clusters sub-population in different local optima. Then we bootstrap the efficiency metrics (ROAS or CPA) to obtain the distribution and the 95% interval.</p></li><li><p><strong>Adstock decay rate:</strong> This chart represents the carryover effect of each media variable (paid &amp; organic). For Geometric adstock, the barchart depicts the fixed decay rate. The higher the value, the stronger the carryover into the future. For Weibull adstock, each sub-chart depicts the time-varying decay rate for each media variable, which might also include lag effect. A common hypothesis of adstock is that offline channels have stronger the carryover.</p></li><li><p><strong>Immediate vs. carryover</strong>: Robyn splits the media contribution into two parts: immediate contribution and carryover contribution. Immediate is the effect of the direct media spend of a given period, while carryover is the effect of historical spend &quot;leaked&quot; (also called adstock) into the given period. Conceptually, the carryover effect can be understood as the effect of upper-/mid-funnel brand equity metrics like &quot;ad recall&quot; or &quot;campaign awareness&quot;. Note that we avoid using the terms &quot;short-term&quot; and &quot;long-term&quot;, because we believe, without any agreed definition, that the &quot;long-term effect&quot; should describe media impact on baseline sales. In comparison, adstocking only addresses media&#x27;s direct impact on the response and says nothing about the interaction with baseline. Note that it&#x27;s possible to have a channel with higher carryover but lower adstock, as seen in this example above with <code>ooh_S</code> vs <code>tv_S</code>. The reason lies in the different saturation curves per media (explained below) that also have impact on the carryover decomposition.</p></li><li><p><strong>Saturation curves:</strong> Saturation curve has many synonyms, like response curve or diminishing return. Robyn calculates one saturation curve (<a href="#saturation">one set of Hill parameters</a>) per media variable. The grey area depicts the historical carryover, as explained in point 6 above: The end of grey area projected on the Y-axis is the carryover effect, while the dot (average spend) projected on Y is the total effect. The difference between these two is the immediate effect. Use your business context to make sense of these curves. For example, an over-spending media variable would expect the dot on the flatter area of the curve, representing lower <strong>marginal ROAS</strong> or <strong>mROAS</strong>, the most important metric for budget allocation. For more details see this article <a href="https://medium.com/@gufengzhou/the-convergence-of-marginal-roas-in-the-budget-allocation-in-robyn-5d407aebf021" target="_blank" rel="noopener noreferrer">&quot;The convergence of marginal ROAS in the budget allocation in Robyn&quot;</a>. Tip: You can also use the <code>robyn_response()</code> function in to recreate these response curves. For details see the <a href="https://github.com/facebookexperimental/Robyn/blob/main/demo/demo.R#L518" target="_blank" rel="noopener noreferrer">demo</a>.</p></li><li><p><strong>Fitted vs. residual:</strong> This chart shows the relationship between fitted and residual values. For a good fitting model, this plot is expected to show rather horizontal trend line with the dots evenly scattered around the X-axis. On the contrary, visible patterns (funnle shape, waves, groupped outliers) indicate missing variable in the model.</p></li></ol><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="budget-allocation">Budget allocation<a href="#budget-allocation" class="hash-link" aria-label="Direct link to Budget allocation" title="Direct link to Budget allocation">â€‹</a></h2><p>Robyn&#x27;s budget allocator comes with two scenarios:</p><ul><li><strong>Maximum response</strong>: Given a total budget and media-level constraints, the allocator calculates the optimum cross-media budget split by maximising the response. For example: &quot;What&#x27;s the optimum media split if I have budget X?&quot;</li><li><strong>Target efficiency (ROAS or CPA)</strong>: Given a target ROAS or CPA and media-level constraints, the allocator calculates the optimum cross-media budget split and the total budget by maximising the response. For example: &quot;What&#x27;s the optimum media split and how much budget do I need if I have want to hit ROAS X?&quot;</li></ul><p>Robyn uses the optimisation package â€œnloptrâ€ to perform the gradient-based nonlinear optimisation with bounds and equality constraints. Augmented Lagrangian (AUGLAG) is used for global optimisation and Sequential Least Square Quadratic Programming (SLSQP) for local optimisation. For algorithmic details please see <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#slsqp" target="_blank" rel="noopener noreferrer">nloptrâ€™s documentation</a>.</p><p>Below is an example allocator onepager:</p><img loading="lazy" alt="budget allocator chart" src="/Robyn/img/optimizer_new.png" class="img_ev3q"><p>For the interpretation of the budget allocation onepager, please refer to the
following deepdive articles:</p><ul><li><strong>&quot;The convergence of marginal ROAS in the budget allocation in Robyn&quot;</strong>: <a href="https://medium.com/@gufengzhou/the-convergence-of-marginal-roas-in-the-budget-allocation-in-robyn-5d407aebf021" target="_blank" rel="noopener noreferrer">here</a></li><li><strong>&quot;Hitting ROAS target using Robynâ€™s budget allocator&quot;</strong>: <a href="https://medium.com/@gufengzhou/hitting-roas-target-using-robyns-budget-allocator-274ace3add4f" target="_blank" rel="noopener noreferrer">here</a></li></ul><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-refresh">Model refresh<a href="#model-refresh" class="hash-link" aria-label="Direct link to Model refresh" title="Direct link to Model refresh">â€‹</a></h2><p>Conventionally, the model refresh cycle of MMM is bi-annual or even longer. The time delay leads to limited actionability of MMM insights. Robyn&#x27;s model refresh feature aims to solve this challenge and enables model refresh and reporting as frequently as the data allows. It also enables MMM to be a continuous reporting tool for actionable and timely decision-making that could feed your reporting or BI tools.</p><p>Conceptually, the model refresh function <code>robyn_refresh()</code> builds on top of an selected initial model, updates its hyperparameter with a narrower range that&#x27;s proportional to the new data / total data ratio and picts an winning model based on the combination of objective functions. Note that model refreshing comes with certain common expectations. When refreshing with a shorter period of new data, it&#x27;s expected:</p><ul><li>that the refreshed model has stable baseline compared to initial model</li><li>that the refreshed model reflects the media spend changes in the new period</li></ul><p>Robyn uses modified objective functions to achieve the above. To be precise, the NRMSE only accounts for the new period while refreshing, because the main goal of refreshing is to better describe the new period. The DECOMP.RSSD is modified to drive only effect share closer to the refresh spend share, while it also accounts for the similarity between new and old baseline.</p><p>The example below shows the model refreshing mechanism for 5 different periods of time based in an initial window covering most of 2017 and 2018:</p><img loading="lazy" alt="pareto chart 2" src="/Robyn/img/refresh-window.png" class="img_ev3q"><p>The second refresh chart shows the model decomposition across initial and various refresh models:</p><img loading="lazy" alt="pareto chart 2" src="/Robyn/img/refresh-reporting.png" class="img_ev3q"><p><strong>Note that this feature is not yet tested thoroughly</strong> and might provide instable refresh results.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebookexperimental/Robyn/edit/main/website/docs/features.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Robyn/docs/analysts-guide-to-MMM"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">An Analyst&#x27;s Guide to MMM</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Robyn/docs/robyn-api"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Robyn API for Python</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-inputs" class="table-of-contents__link toc-highlight">Model Inputs</a><ul><li><a href="#paid-media-variables" class="table-of-contents__link toc-highlight">Paid Media Variables</a></li><li><a href="#organic-variables" class="table-of-contents__link toc-highlight">Organic Variables</a></li><li><a href="#contextual-variables" class="table-of-contents__link toc-highlight">Contextual Variables</a></li><li><a href="#the-demand-map" class="table-of-contents__link toc-highlight">The &quot;demand map&quot;</a></li></ul></li><li><a href="#variable-transformations" class="table-of-contents__link toc-highlight">Variable Transformations</a><ul><li><a href="#adstock" class="table-of-contents__link toc-highlight">Adstock</a></li><li><a href="#saturation" class="table-of-contents__link toc-highlight">Saturation</a></li></ul></li><li><a href="#trend--seasonality-decomposition-with-prophet" class="table-of-contents__link toc-highlight">Trend &amp; seasonality decomposition with Prophet</a><ul><li><a href="#exemplary-time-series-decomposition" class="table-of-contents__link toc-highlight">Exemplary time-series decomposition</a></li></ul></li><li><a href="#ridge-regression" class="table-of-contents__link toc-highlight">Ridge Regression</a></li><li><a href="#multi-objective-hyperparameter-optimization-with-nevergrad" class="table-of-contents__link toc-highlight">Multi-Objective Hyperparameter Optimization with Nevergrad</a><ul><li><a href="#objective-functions" class="table-of-contents__link toc-highlight">Objective Functions</a></li><li><a href="#hyperparameters" class="table-of-contents__link toc-highlight">Hyperparameters</a></li></ul></li><li><a href="#time-series-validation" class="table-of-contents__link toc-highlight">Time Series Validation</a></li><li><a href="#model-clustering" class="table-of-contents__link toc-highlight">Model Clustering</a></li><li><a href="#calibration-with-causal-experiments" class="table-of-contents__link toc-highlight">Calibration with causal experiments</a><ul><li><a href="#key-findings-of-calibration" class="table-of-contents__link toc-highlight">Key findings of calibration</a></li><li><a href="#types-of-experiments" class="table-of-contents__link toc-highlight">Types of experiments</a></li></ul></li><li><a href="#model-onepager" class="table-of-contents__link toc-highlight">Model onepager</a></li><li><a href="#budget-allocation" class="table-of-contents__link toc-highlight">Budget allocation</a></li><li><a href="#model-refresh" class="table-of-contents__link toc-highlight">Model refresh</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/resident" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Resident<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/success/central-retail-corporation" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Central Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/business/measurement/case-studies/bark" target="_blank" rel="noopener noreferrer" class="footer__link-item">Case study: Bark<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.facebook.com/groups/954715125296621" target="_blank" rel="noopener noreferrer" class="footer__link-item">Robyn MMM Users Facebook Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Raise an issue on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/Robyn/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2024 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Robyn/assets/js/runtime~main.aa789c18.js"></script>
<script src="/Robyn/assets/js/main.4baa0a5c.js"></script>
</body>
</html>