<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Robyn/blog/rss.xml" title="Robyn Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Robyn/blog/atom.xml" title="Robyn Blog Atom Feed"><title data-react-helmet="true">Step-by-step guide | Robyn</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Step-by-step guide | Robyn"><meta data-react-helmet="true" name="description" content="Load data &amp; scripts"><meta data-react-helmet="true" property="og:description" content="Load data &amp; scripts"><meta data-react-helmet="true" property="og:url" content="https://facebookexperimental.github.io/Robyn//Robyn/docs/doc12"><link data-react-helmet="true" rel="shortcut icon" href="/Robyn/img/robyn_logo.png"><link data-react-helmet="true" rel="canonical" href="https://facebookexperimental.github.io/Robyn//Robyn/docs/doc12"><link rel="stylesheet" href="/Robyn/styles.66bd18a3.css">
<link rel="preload" href="/Robyn/styles.8dda7a15.js" as="script">
<link rel="preload" href="/Robyn/runtime~main.45b9a820.js" as="script">
<link rel="preload" href="/Robyn/main.b745b9ff.js" as="script">
<link rel="preload" href="/Robyn/1.494bc5d3.js" as="script">
<link rel="preload" href="/Robyn/18.01f78df9.js" as="script">
<link rel="preload" href="/Robyn/19.09bfab9f.js" as="script">
<link rel="preload" href="/Robyn/935f2afb.08a10c46.js" as="script">
<link rel="preload" href="/Robyn/17.5366a0ae.js" as="script">
<link rel="preload" href="/Robyn/009561a5.b557d23d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Robyn/"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Robyn</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Robyn/docs/doc11">About Robyn</a><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Robyn/"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Robyn/img/robyn_logo.png" alt="Robyn Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Robyn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/Robyn/docs/doc11">About Robyn</a></li><li class="menu__list-item"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">How-to guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Robyn/docs/doc3">Quick Start</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Robyn/docs/doc12">Step-by-step guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Features</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc4">Ridge Regression</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc5">Variable Transformations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc6">Facebook Prophet - Trend, Seasonality and Holiday Effects</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc7">Automated hyperparameter selection and optimization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc8">Calibration using experimental results</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc9">Outputs and diagnostics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc10">Getting help and contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Robyn/docs/doc11">About Robyn</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Step-by-step guide</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="load-data--scripts"></a>Load data &amp; scripts<a class="hash-link" href="#load-data--scripts" title="Direct link to heading">#</a></h2><p>The first step is to load data and scripts, you can start with our simulated data file (de_simulated_data.csv) if you want to practice at the beginning.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">script_path &lt;- str_sub(rstudioapi::getActiveDocumentContext()$path, start = 1, end = max(unlist(str_locate_all(rstudioapi::getActiveDocumentContext()$path, &quot;/&quot;))))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dt_input &lt;- fread(paste0(script_path,&#x27;de_simulated_data.csv&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">holidays &lt;- fread(paste0(script_path,&#x27;generated_holidays.csv&#x27;))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Our script has been designed to pull files automatically from the folder where the ‚Äòfb_nextgen_mmm.exec.R‚Äô script resides. If you would like to use a new data input file instead of our simulated data you will need to save it in the same folder and replace dt_input.csv file as in the example below:
Before
dt_input &lt;- fread(paste0(script_path,&#x27;de_simulated_data.csv&#x27;))
After
dt_input &lt;- fread(paste0(script_path,&#x27;your_input_data_file.csv&#x27;))</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set-model-input-variables"></a>Set model input variables<a class="hash-link" href="#set-model-input-variables" title="Direct link to heading">#</a></h2><p>Once you have defined the input files to work with and loaded to the source all the functions needed to run the code. You will need to define and set the input variables.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_country"></a>set_country<a class="hash-link" href="#set_country" title="Direct link to heading">#</a></h3><p>The first variable to declare is the country. We recommend using only one country especially if you are planning to leverage prophet for trend and seasonality which automatically pulls holidays for the country you have selected and simplifies the process.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_country &lt;- &quot;DE&quot; # only one country allowed. Used in prophet holidays</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_datevarname"></a>set_dateVarName<a class="hash-link" href="#set_datevarname" title="Direct link to heading">#</a></h3><p>For date variables you must have in mind that the DATE column in your dataset has to be in  &quot;yyyy-mm-dd &quot; format. ie. &quot;2020-01-01&quot;</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_dateVarName &lt;- c(&quot;DATE&quot;) # date must be format &quot;2020-01-01&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_depvarname-and-set_depvartype"></a>set_depVarName and set_depVarType<a class="hash-link" href="#set_depvarname-and-set_depvartype" title="Direct link to heading">#</a></h3><p>Setting the dependent variable is basically the outcome you are trying to measure. We only accept one dependent variable under set_depVarName. This variable can take the form of revenue (Sales or profit in monetary values) or conversion (Number of transactions, units sold) which you will indicate when defining the set_depVarType variable.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_depVarName &lt;- c(&quot;revenue&quot;) # there should be only one dependent variable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_depVarType &lt;- &quot;revenue&quot; # &quot;revenue&quot; or &quot;conversion&quot; are allowed</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set-prophet-variables"></a>Set Prophet variables<a class="hash-link" href="#set-prophet-variables" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="activate_prophet"></a>activate_prophet<a class="hash-link" href="#activate_prophet" title="Direct link to heading">#</a></h4><p>First you will need to indicate the model if you would like to turn on or off the Prophet feature in the code to be used for seasonality, trend and holidays. T (True) means it is activated and F (False) deactivated.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">activate_prophet &lt;- T</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_prophet"></a>set_prophet<a class="hash-link" href="#set_prophet" title="Direct link to heading">#</a></h4><p>The next step is to select which of the provided outcomes of Prophet you will use in the model. It is recommended to at least keep trend and holidays. Please have in mind that &quot;trend&quot;,&quot;season&quot;, &quot;weekday&quot;, &quot;holiday&quot; are provided and case-sensitive.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_prophet &lt;- c(&quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_prophetvarsign"></a>set_prophetVarSign<a class="hash-link" href="#set_prophetvarsign" title="Direct link to heading">#</a></h4><p>You may define the variable sign control for prophet variables to be &quot;default&quot;, &quot;positive&quot;, or &quot;negative&quot;. If you are expecting coefficients for prophet variables such as &quot;trend&quot;, &quot;season&quot;, &quot;holiday&quot; to be default (either positive or negative), positive or negative. We recommend using default. Please remember the object declared must be same length as set_prophet‚Äôs</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_prophetVarSign &lt;- c(&quot;default&quot;,&quot;default&quot;, &quot;default&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="test-and-visualise-prophets-decomposition"></a>Test and visualise prophet‚Äôs decomposition<a class="hash-link" href="#test-and-visualise-prophets-decomposition" title="Direct link to heading">#</a></h4><p>You may drill-down into prophet results to understand better the outcomes provided by the tool by executing the following command.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.getProphet(dt_input)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set-baseline-variables"></a>Set Baseline variables<a class="hash-link" href="#set-baseline-variables" title="Direct link to heading">#</a></h3><p>The following step is to set the baseline variables which typically are things like competitors, pricing, promotions, temperature, unemployment rate and any other variable that is not media exposure but has a strong relationship with sales outcomes. You will need to indicate the model if you would like to turn on or off baseline variables in the code. T (True) means it is activated and F (False) deactivated.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">activate_baseline &lt;- T</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You may then define the different baseline variables you would like to consider.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_baseVarName &lt;- c(&quot;promotions&quot;, &quot;price changes&quot;, &quot;competitors sales&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>You may apply sign control for baseline variables to be &quot;default&quot;, &quot;positive&quot;, or &quot;negative&quot;. If you are expecting coefficients for baseline variables such as &quot;promotions&quot;, &quot;price changes&quot;, &quot;competitors sales&quot; to be default (either positive or negative), positive or negative depending on its expected relationship with the dependent variable. For example, rainy weather may have a positive or negative impact in sales depending on the business. Please remember the object declared must be same length as set_baseVarName‚Äôs</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_baseVarSign &lt;- c(&quot;negative&quot;) # c(&quot;default&quot;, &quot;positive&quot;, and &quot;negative&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_mediavarname-and-set_mediaspendname"></a>set_mediaVarName and set_mediaSpendName<a class="hash-link" href="#set_mediavarname-and-set_mediaspendname" title="Direct link to heading">#</a></h3><p>There is one key restriction to have in mind here, you must have spend variables declared for every media channel you would like to measure. So they have to be in the same order and same length as set_mediaVarName variables.</p><p>Correct</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaVarName &lt;- c(&quot;tv_S&quot;    ,&quot;ooh_S&quot;,   &quot;print_S&quot;   ,&quot;facebook_I&quot;   ,&quot;search_clicks_P&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaSpendName &lt;- c(&quot;tv_S&quot;  ,&quot;ooh_S&quot;,   &quot;print_S&quot;   ,&quot;facebook_S&quot;   ,&quot;search_S&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Incorrect</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaVarName &lt;- c(&quot;tv_S&quot;    ,&quot;ooh_S&quot;,   &quot;print_S&quot;   ,&quot;facebook_I&quot;   ,&quot;search_clicks_P&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaSpendName &lt;- c(&quot;tv_S&quot;  ,&quot;ooh_S&quot;,   &quot;print_S&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set_mediavarsign"></a>set_mediaVarSign<a class="hash-link" href="#set_mediavarsign" title="Direct link to heading">#</a></h4><p>You may apply sign control for media variables to be &quot;default&quot;, &quot;positive&quot;, or &quot;negative&quot;. If you are expecting coefficients for baseline variables such as &quot;tv&quot;, &quot;print&quot;, &quot;facebook&quot; to be default (either positive or negative), positive or negative depending on its expected relationship with the dependent variable. We recommend using positive for all. Please remember the object declared must be same length as set_mediaVarName‚Äôs</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaVarSign &lt;- c(&quot;positive&quot;, &quot;positive&quot;, &quot;positive&quot;, &quot;positive&quot;, &quot;positive&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set-factor-variables"></a>Set factor variables<a class="hash-link" href="#set-factor-variables" title="Direct link to heading">#</a></h3><p>If any variable above should be factor please include it in this section of the code, otherwise leave it empty as by default ‚Äúc()‚Äù</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_factorVarName &lt;- c()</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="set-global-model-parameters"></a>Set global model parameters<a class="hash-link" href="#set-global-model-parameters" title="Direct link to heading">#</a></h2><p>In this section you will have to define parameters values and bounds for the model to start working:</p><ol><li><p>The <strong>number of cores</strong> in your computer to be used for <strong>parallel computing</strong></p></li><li><p>The <strong>data training size</strong> (set_modTrainSize) which will indicate the percentage of data to be used to train the model, therefore, the percentage left (1- training size) to validate the model.</p><ol><li>The function f.plotTrainSize helps you select the best split. Set the function to f.plotTrainSize(TRUE) to plot the Bhattacharyya coefficient, an indicator for the similarity of two distributions, for the training size 50-90%. The higher the Bhatta coefficient, the more similar the train and test data splits and thus the better the potential model fit in the end.</li></ol></li><li><p>The adstocking method which can be <a href="https://en.wikipedia.org/wiki/Geometric_distribution" target="_blank" rel="noopener noreferrer">Geometric</a> or <a href="https://en.wikipedia.org/wiki/Weibull_distribution" target="_blank" rel="noopener noreferrer">Weibull</a> distributions.</p></li><li><p>The <strong>number of iterations</strong> (set_iter) your model will have to find optimum values for coefficients.</p></li><li><p>The <strong>hyperparameters bounds</strong> which we recommend to leave as default but can be changed according to learnings from model iterations and analysts‚Äô past experience.</p><ol><li><p><strong>The definition of each hyperparameter:</strong></p><ol><li><strong>Thetas</strong>: Geometric function decay rate</li><li><strong>Shapes</strong>: Weibull parameter that controls the decay shape between exponential and s-shape</li><li><strong>Scales</strong>: Weibull parameter that controls the position of inflection point</li><li><strong>Alphas</strong>: Hill function (Diminishing returns) parameter that controls the shape between exponential and s-shape</li><li><strong>Gammas</strong>: Hill function (Diminishing returns) parameter that controls the scale of transformation</li><li><strong>Lambdas</strong>: Regularization penalty parameter for ridge regression</li></ol></li><li><p><strong>Understanding how adstock affects media transformation:</strong></p><ol><li>In order to make more informed decisions to define hyperparameter values, it‚Äôs very helpful to know which hyperparameter is doing what during the media transformation. The plot function f.plotAdstockCurves helps you understand exactly that.</li><li>Below is the geometric adstock that is a one parameter (theta) function. Assume the time unit is week, then we can see that when theta=0.9, meaning 90% of the media effect this week carries over to the next week, the halflife enters after 8 weeks (halflife value in legend). In other words, it takes 8 weeks until the media effect decays to half when theta=0.9. This should help you having a more tangible feeling about if the theta value for this certain channel makes normal sense.</li></ol></li></ol></li></ol><img alt="adstockintro chart" src="/Robyn/img/adstockintro.png"><p>Similar to above, this plot visualises the two-parameter (scale &amp; shape) Weibull function. The upper plot shows changes in scale while keeping shape constant. We can observe that the larger the scale, the later the inflexion point. When scale=0.5 and shape = 2, it takes 18 weeks until the media effect decays to half (see legend). The lower plot shows changes in shape while keeping scale constant. When shape is smaller, the curve  rather takes on the L-shape. When shape is larger, the curve rather takes on S-shape.</p><img alt="adstockintro2 chart" src="/Robyn/img/adstockintro2.png"><p>In order to start setting model parameters we recommend to start with the Geometric function.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">## set model core features</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">adstock &lt;- &quot;geometric&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This function is simpler and therefore easier to understand compared to the weibull function.  You may start by focusing on Thetas‚Äô bounds, which controls for the decay rate any channel could take. If you are not sure about decay rates for your channels, we suggest you start with a range: thetas = c(0, 0.5). This means that in a week by week dataset, we would be expecting a maximum carryover effect of 50% of previous week‚Äôs values to be extended and added to the following week‚Äôs values for the dependent variable (Sales, impressions, etc.)</p><p>Once you run one of the iterations you may notice theta&#x27;s values and if certain optimums have been found by looking into variables including &#x27;thetas&#x27; on their names and identifying the number of times an optimum was found (epoch.optim).</p><img alt="coderesults1 chart" src="/Robyn/img/coderesults1.png"><p>In the example above, you will see that Facebook and TV thetas are still missing an optimum given that optim.found column has still TRUE values on it, for this we suggest to increase epoch number to Inf (Infinity) until an optimum is found.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">model_output &lt;- f.mmmRobyn(set_hyperBoundGlobal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          ,set_iter = set_iter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          ,set_cores = set_cores</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          ,epochN = Inf # set to Inf to auto-optimise until no optimum found</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          ,optim.sensitivity = 0 # must be from -1 to 1. Higher sensitivity means finding optimum easier</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          ,temp.csv.path = &#x27;/Users/leonelsentana/Documents/mmm.tempout.csv&#x27; # output optimisation result for each epoch. Use getwd() to find path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Below an example reaching optimum in 33 epochs:</p><img alt="coderesults2 chart" src="/Robyn/img/coderesults2.png"><p>You may note all parameters state FALSE which means there are not any more optimums to find. This indicates that the values found are optimal, and that if wanted, you could use some of these mode values to fix hyperparameter values in the #### tune channel hyperparameters bounds section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tune-channel-hyperparameters-bounds"></a>Tune channel hyperparameters bounds<a class="hash-link" href="#tune-channel-hyperparameters-bounds" title="Direct link to heading">#</a></h2><p>For that you will need to set the following command to TRUE:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">activate_hyperBoundLocalTuning &lt;- T</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This command will enable you to define the bounds each media‚Äôs parameter should have manually. Please uncomment the following section of the code and define the values. Each bound can be either a range (e.g c(0.1,0.9)) or a fixed value:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> set_hyperBoundLocal &lt;- list(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   facebook_I_alphas = c(0.8356271, 0.8371774)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,facebook_I_gammas = c(0.8991811, 0.9012183)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,facebook_I_thetas = c(0.8700282)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_alphas = c(0.8348503)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_gammas = c(0.3565417)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_thetas = c(0.3815053)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_alphas = c(0.6490568)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_gammas = c(0.1165910, 0.1171953)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_thetas = c(0.7617390)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_alphas = c(2.4880460)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_gammas = c(0.8867124)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_thetas = c(0.1477954, 0.1478531)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_alphas = c(0.1360708)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_gammas = c(0.4177802)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_thetas = c(0.5784685)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The hyperparameters tuning section is especially handy when we know there is an expected behavior behind parameters e.g. adstocking for TV decay rate taking only a value within a range. In this case, we would recommend you to guide the model towards a solution that is both optimal and meets your needs based on experience from previous analyses.</p><img alt="coderesults2 chart" src="/Robyn/img/coderesults2.png"><p>If we consider our previous example, it could be the case where you may want to tune Theta decay rates to control for the adstocking decay pacing of TV to <strong>tv_S_thetas = c(0.25, 0.35)</strong>. If we also fix other values where optimums have been reached, we would reach something like the example below with fix values and ranges based on previous iterations and past experience:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#Please uncomment set_hyperBoundLocal list completely and use scales and shapes only if you</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#have selected ‚Äòadstock &lt;- &quot;weibull&quot;‚Äô. If you selected adstock &lt;- &quot;geometric&quot; as by default, then simply #use alphas, gammas and thetas for each channel.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> set_hyperBoundLocal &lt;- list(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   facebook_I_alphas = c(0.8356271, 0.8371774)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,facebook_I_gammas = c(0.8991811, 0.9012183)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,facebook_I_thetas = 0.8700282</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_alphas = 0.8348503</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_gammas = 0.3565417</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,ooh_S_thetas = 0.3815053</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_alphas = 0.6490568</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_gammas = c(0.1165910, 0.1171953)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,print_S_thetas = 0.7617390</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_alphas = 0.1360708</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_gammas = 0.4177802</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,search_clicks_P_thetas = 0.5784685</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_alphas = 2.4880460</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_gammas = 0.8867124</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ,tv_S_thetas = c(0.25, 0.35)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If we apply the above bounds to our media related variables, you may see that results now reach an optimum much faster, after only 2 epochs instead of 33. You may also observe that the new bounds for <strong>tv_S_thetas = c(0.25, 0.35)</strong> have been applied, therefore the new optimum found is 0.2706085 instead of the 0.1478256 from the previous example.</p><img alt="coderesults3 chart" src="/Robyn/img/coderesults3.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="plotting-and-understanding-results"></a>Plotting and understanding results<a class="hash-link" href="#plotting-and-understanding-results" title="Direct link to heading">#</a></h2><p>The first thing you will have to do, is to set every plot you would like to be drawn to TRUE (T):</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#### Plot section</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">## insert TRUE into plot functions to plot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotSpendModel(F)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotHyperSamp(F, channelPlot = set_mediaVarName) # plot latin hypercube hyperparameter sampling balance. Max. 3 channels per plot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotTrendSeason(F) # plot prophet trend, season and holiday decomposition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bestAdstock &lt;- f.plotMediaTransform(T, channelPlot = set_mediaVarName) # plot best model media transformation with 3 plots: adstock decay rate, adstock effect &amp; response curve. Max. 3 channels per plot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotBestDecomp(F) # plot best model decomposition with 3 plots: sales decomp, actual vs fitted over time, &amp; sales decomp area plot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotMAPEConverge(F) # plot RS MAPE convergence, only for random search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotBestModDiagnostic(F) # plot best model diagnostics: residual vs fitted, QQ plot and residual vs. actual</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotChannelROI(F)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">f.plotHypConverge(F, channelPlot = set_mediaVarName) # plot hyperparameter vs MAPE convergence. Max. 3 channels per plot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">boundOptim &lt;- f.plotHyperBoundOptim(F, channelPlot = set_mediaVarName, model_output, kurt.tuner = optim.sensitivity)  # improved hyperparameter plot to better visualise trends in each hyperparameter</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>After that, you may execute each plot separately and analyze it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplotspendmodel-plotting-the-spend-reach-fitting-with-michaelis-menten-model"></a>f.plotSpendModel: Plotting the spend-reach fitting with Michaelis-Menten model<a class="hash-link" href="#fplotspendmodel-plotting-the-spend-reach-fitting-with-michaelis-menten-model" title="Direct link to heading">#</a></h3><p>The plot below illustrates how to better translate the relationship between spend and reach so that you can apply it to performance ROI (Revenue/spend) calculations. It is possible to choose reach variables (GRP, impressions, actual reach, etc.) in the model. Understanding that relationship can help with the translation of reach to spend and vice versa.
LM (Linear Model) and NLS (Non-linear least squares) comparison shows why it is better to use a non-linear model, which is the technique applied in the code. The linear model is actually as primitive as just using average to scale, because in our case the intercept is omitted given that we assume no spend involves no reach. Whereas NLS are more flexible and should adapt better to the underlying correlation patterns between both variables.</p><img alt="plotSpendModel chart" src="/Robyn/img/plotSpendModel.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplothypersamp-checking-latin-hypercube-sampling-distribution"></a>f.plotHyperSamp: checking latin hypercube sampling distribution<a class="hash-link" href="#fplothypersamp-checking-latin-hypercube-sampling-distribution" title="Direct link to heading">#</a></h3><p>The overall idea of these charts is to validate the <strong>Latin hypercube sampling (LHS)</strong>, which is a statistical method for generating a near-random sample of parameter values from the multidimensional distribution of hyperparameters. It consists of two main charts:</p><ul><li><strong>Latin Hypercube Sampling distribution:</strong> The key aspect is to concentrate on the randomness of the points on this chart. If all dots seem to cover evenly the space as in the example below, then sampling is ok. However, beware of high concentrations of dots or clear areas without any dots which may mean you will have to increase the sampling to have a better representation of the hyperspace.</li><li><strong>Latin Hypercube Sampling distribution transformed:</strong> This is a half violin chart that represents the distribution of each media parameter values. It helps you understand the actual range of values that each parameter is taking in order to represent uniformly the hyperparameter space. It will also depend on the set_hyperBoundGlobal variable and its bound definitions.</li></ul><img alt="plotHyperSamp chart" src="/Robyn/img/plotHyperSamp.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplottrendseason-understanding-trend-and-seasonality"></a>f.plotTrendSeason: Understanding trend and seasonality<a class="hash-link" href="#fplottrendseason-understanding-trend-and-seasonality" title="Direct link to heading">#</a></h3><p>This plot describes the trend, holidays and seasonality along the analyzed period.</p><ul><li>The <strong>trend</strong> is the component of a time series that represents low frequency variations in time. It reflects the underlying tendency behind the dependent variable which can reflect growth, stability or shrinkage depending on the time unit analyzed.</li><li><strong>Holidays</strong> are basically days defined by governments where people commemorate events which can affect consumption behaviors. Some holidays may have more impact than others, therefore the different magnitudes on the chart.</li><li><strong>Seasonality</strong> is a characteristic of a time series in which the time series experiences regular and predictable changes that recur every calendar year. Any predictable fluctuation or pattern that recurs or repeats over a one-year period is said to be seasonal. Below we have the yearly seasonality as an example, which shows higher demand between October and December, and lower demand between April and July.</li></ul><img alt="plotTrendSeason chart" src="/Robyn/img/plotTrendSeason.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bestadstock-adstock-carryover-and-diminishing-returns-effects"></a>bestAdstock: Adstock carryover and diminishing returns effects<a class="hash-link" href="#bestadstock-adstock-carryover-and-diminishing-returns-effects" title="Direct link to heading">#</a></h3><p>This plot represents the relationship between spend or ROI, and the response variable (Sales, conversions, etc.).
On the first line of charts you will find:
The response curve which can be S or C like, its scale of growth and diminishing returns pace.
The profit curve which illustrates the difference between the Y and X axes (Response-profit). The higher this curve is on the Y axis, the closer to a max profit point you will get.
The second line of charts displays the relationship between ROI and spend, the higher the curve on the Y axis, the greater the response obtained. Maximum and Average ROI are drawn for an easier read.</p><p>Note: This plot admits only 3 channels at a time. Please select the 3 channels you would like to analyze as in the example below where first we look at channel names, and second, we indicate which names within set_mediaVarName object to plot c(1,2,5) :</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">set_mediaVarName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">bestAdstock &lt;- f.plotMediaTransform(T, channelPlot = set_mediaVarName[c(1,2,5)])</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><img alt="bestAdstock chart" src="/Robyn/img/bestAdstock.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplotbestdecomp-understanding-the-effect-of-baseline-media-variables-trend-and-seasonality-along-time"></a>f.plotBestDecomp: Understanding the effect of baseline, media variables trend and seasonality along time<a class="hash-link" href="#fplotbestdecomp-understanding-the-effect-of-baseline-media-variables-trend-and-seasonality-along-time" title="Direct link to heading">#</a></h3><p>The aim of this chart is to display the breakdown of the response variable through time and the relationship with each of its regressing components. As with all marketing mix models, both media and non-media related explanatory factors are displayed, including baseline effects such as price and promotions, as well as, trend , seasonality and holidays. In order to be able to make a proper description and forecast of performance, we must know to what extent each component is present in the data.</p><img alt="plotBestDecomp chart" src="/Robyn/img/plotBestDecomp.png"><p>The chart below illustrates the contribution of each regressor variable to the overall response (Sales in this case) You may find for example that Facebook impressions had a 7.6% contribution to overall sales which represent in total $28.8 million.</p><img alt="bestDecomp2 chart" src="/Robyn/img/bestDecomp2.png"><p>The next chart shows the difference between real and predicted values. The closer the lines for y and y_pred, the better. You may also find RSQ and MAPE metrics. RSQ or R-squared (R2) is a statistical measure that represents the proportion of the variance for a dependent variable that is explained by an independent variable or variables in a regression model. In general terms, the closer to one, the better.  Whereas, the mean absolute percentage error (MAPE) is the mean or average of the absolute percentage errors of forecasts. Error is defined as actual or observed value minus the forecasted value. As a general rule, the closer to zero the better.</p><img alt="bestDecomp3 chart" src="/Robyn/img/bestDecomp3.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplotmapeconverge-understanding-mape-evolution-per-random-search-iteration-and-minutes-spent"></a>f.plotMAPEConverge: Understanding MAPE evolution per Random Search iteration and minutes spent<a class="hash-link" href="#fplotmapeconverge-understanding-mape-evolution-per-random-search-iteration-and-minutes-spent" title="Direct link to heading">#</a></h3><p>The chart below displays the evolution of the mean absolute percentage error (MAPE) with every minute spent on computing. This chart will help you understand how many random search iterations to include in the model under <strong>set_iter</strong> variable. If you increase set_iter from 100 to 10000, you will reach a point where MAPE will not decrease in time. Therefore, finding the optimum may be between 100 and 10000 may be your next step until you find the balance between computing time and MAPE reduction.</p><img alt="plotMAPEConverge chart" src="/Robyn/img/plotMAPEConverge.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplotbestmoddiagnostic-plot-best-model-diagnostics-residual-vs-fitted-qq-plot-and-residual-vs-actual"></a>f.plotBestModDiagnostic: plot best model diagnostics: residual vs fitted, QQ plot and residual vs. actual<a class="hash-link" href="#fplotbestmoddiagnostic-plot-best-model-diagnostics-residual-vs-fitted-qq-plot-and-residual-vs-actual" title="Direct link to heading">#</a></h3><p>Across these plots we analyze residuals, which are the difference between the observed value of the dependent variable (y) and the predicted value (≈∑).</p><ul><li><p><strong>Fitted vs. Residual:</strong> When conducting a residual analysis, a &quot;residuals versus fitted plot&quot; is the most frequently created plot. It is a scatter plot of residuals on the y axis and fitted values (estimated responses) on the x axis. The plot is used to detect non-linearity, unequal error variances, and outliers. The more random the pattern for the dots distribution in this plot and the more horizontal the smooth line, the better, as it would mean linearity, independent error variances and absence of outliers.</p></li><li><p><strong>QQ Plot:</strong> The quantile-quantile (q-q) plot is a graphical technique to determine if two data sets come from populations with a common distribution. A q-q plot is a plot of the quantiles of the first data set against the quantiles of the second data set in this case observed Y and Y_pred. A 45-degree reference line is also plotted. The closer the dots to the 45 degrees line, the better.</p></li><li><p><strong>Observed vs. Residual:</strong> Compared to the Fitted vs. Residual plot, this plot shows more correlation between observed/true response vs. residuals when the model R2 is lower. Normally, a certain degree of correlation here means either the data is just noisy or there‚Äôs still missing patterns within the error. In the context of MMM, we would recommend to assume the latter one and look for potential additional predictors to also capture these patterns.
When conducting a residual analysis, a &quot;residuals versus observed plot&quot; is commonly used as a complement of residual vs. fitted plots. It is a scatter plot of residuals on the y axis and observed values (Actual responses) on the x axis. The plot is used to detect non-linearity, unequal error variances, and outliers. The more uniform the dots distribution in this plot and the more horizontal the smooth line, the better as it would mean independent error variances and absence of outliers. The contrast between fitted and observed vs. residual charts helps to understand if there are common relationships between both and residuals.</p></li></ul><img alt="f.plotBestModDiagnostic chart" src="/Robyn/img/f.plotBestModDiagnostic.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplotchannelroi-understanding-performance-with-spend-and-return-of-investment-charts"></a>f.plotChannelROI: Understanding performance with spend and return of investment charts<a class="hash-link" href="#fplotchannelroi-understanding-performance-with-spend-and-return-of-investment-charts" title="Direct link to heading">#</a></h3><p>The plot below reflects a simple comparison of ROI and Spend per channel. The greater the ROI (Return on investment) the better.</p><img alt="plotChannelROI chart" src="/Robyn/img/plotChannelROI.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplothypconverge-correlation-and-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error"></a>f.plotHypConverge: Correlation and convergence of hyperparameters and MAPE (Mean Absolute Percentage Error)<a class="hash-link" href="#fplothypconverge-correlation-and-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error" title="Direct link to heading">#</a></h3><p>The plot below describes the relationship between mean absolute percentage error (MAPE) and each hyperparameter range of values. It aims to assist you in finding the right Hyperparameters bounds that will help on MAPE reduction, its minimum values are indicated with a vertical line.</p><img alt="plotHypConverge chart" src="/Robyn/img/f.plotHypConverge.png"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="fplothyperboundoptim-improved-plot-for-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error"></a>f.plotHyperBoundOptim: Improved plot for convergence of hyperparameters and MAPE (Mean Absolute Percentage Error)<a class="hash-link" href="#fplothyperboundoptim-improved-plot-for-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error" title="Direct link to heading">#</a></h3><p>Similar to the previous plot, this plot illustrates the relationship between mean absolute percentage error (MAPE) and each hyperparameter range of values via kurtosis distributions. It aims to assist you in finding the right Hyperparameters bounds that will help on MAPE reduction, its minimum values are indicated with a vertical line, in this case the mode. The mode can be taken as the most frequent value, therefore indicating, together with low and up vertical lines, the possible bounds to be adjusted on <strong>set_hyperBoundLocal</strong> variable</p><img alt="f.plotHyperBoundOptim chart" src="/Robyn/img/f.plotHyperBoundOptim.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="using-the-optimiser"></a>Using the optimiser<a class="hash-link" href="#using-the-optimiser" title="Direct link to heading">#</a></h2><p>Optimiser is also named scenario planner. It gives you the optimum media mix, meaning getting the most return out of a certain spend level, while holding true to a set of constraints.
Please note that the optimiser will only output reasonable optimisation when the MMM result makes sense, meaning all media channels have already found reasonable hyperparameters for adstocking and S-curving and the responses for each channel is meeting your expectations. Otherwise, the optimiser output is not interpretable.
Technically, the optimiser consumes the response curve (Hill function) for each channel provided by the MMM result and conducts the solver for nonlinear optimisation. The gradient-based algorithms (augmented Lagrangian / AUGLAG for global optimisation and Method of Moving Asymptotes / MMA for local optimization) are chosen to solve the nonlinear optimisation problem with equal and unequal constraints. For details see <a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Our current optimiser has two scenarios:</p><ul><li>Maximum historical response (max_hostorical_response): Assuming two years of data for five media channels is used to build the model. Total spend was 1MM ‚Ç¨ with 40/30/15/10/5 split for both channels and total return was 2MM‚Ç¨. The optimiser will output the optimum split for the historical spend level of 1MM‚Ç¨. For example, a maximum return of 2.5MM would be achieved with 35/25/20/12/8 split of the 1MM‚Ç¨ spent.</li></ul><img alt="optimiser1 chart" src="/Robyn/img/optimiser1.png"><ul><li>Maximum response of expected spend (max_response_expected_soend): Compared to the above, this scenario outputs the optimum split of spend for a certain spend level, not the historical spend level. For example, if you have 100k‚Ç¨ for the next quarter, you would define expected_spend = 100000 and expected_spend_days = 90.</li></ul><img alt="optimiser2 chart" src="/Robyn/img/optimiser2.png"><p>For both scenarios, you must also define the constraints (lower and upper bounds) for each channel with the parameter channel_constr_low and channel_constr_up. Assuming for channel A you‚Äôve spent 10k‚Ç¨ per week on average, then channel_constr_low = 0.7 and channel_constr_up = 1.2 will not allow the optimiser to go lower than 7k‚Ç¨ or higher than 12k‚Ç¨ for channel A when running the optimisation.
In general, please use realistic scenarios and avoid putting too extreme values. The optimiser is still based on your historical performance. For example, if you put 10 times as much as your historical spend, the optimiser result might not be making sense.</p><p>The result would look like the following. Again, we want to address that the result of optimiser will only be interpretable if the MMM result makes sense.</p><img alt="optimiser3 chart" src="/Robyn/img/optimiser3.png"></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebookexperimental/Robyn/docs/doc12.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Robyn/docs/doc3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Quick Start</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Robyn/docs/doc4"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ridge Regression ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#load-data--scripts" class="table-of-contents__link">Load data &amp; scripts</a></li><li><a href="#set-model-input-variables" class="table-of-contents__link">Set model input variables</a><ul><li><a href="#set_country" class="table-of-contents__link">set_country</a></li><li><a href="#set_datevarname" class="table-of-contents__link">set_dateVarName</a></li><li><a href="#set_depvarname-and-set_depvartype" class="table-of-contents__link">set_depVarName and set_depVarType</a></li><li><a href="#set-prophet-variables" class="table-of-contents__link">Set Prophet variables</a></li><li><a href="#set-baseline-variables" class="table-of-contents__link">Set Baseline variables</a></li><li><a href="#set_mediavarname-and-set_mediaspendname" class="table-of-contents__link">set_mediaVarName and set_mediaSpendName</a></li><li><a href="#set-factor-variables" class="table-of-contents__link">Set factor variables</a></li></ul></li><li><a href="#set-global-model-parameters" class="table-of-contents__link">Set global model parameters</a></li><li><a href="#tune-channel-hyperparameters-bounds" class="table-of-contents__link">Tune channel hyperparameters bounds</a></li><li><a href="#plotting-and-understanding-results" class="table-of-contents__link">Plotting and understanding results</a><ul><li><a href="#fplotspendmodel-plotting-the-spend-reach-fitting-with-michaelis-menten-model" class="table-of-contents__link">f.plotSpendModel: Plotting the spend-reach fitting with Michaelis-Menten model</a></li><li><a href="#fplothypersamp-checking-latin-hypercube-sampling-distribution" class="table-of-contents__link">f.plotHyperSamp: checking latin hypercube sampling distribution</a></li><li><a href="#fplottrendseason-understanding-trend-and-seasonality" class="table-of-contents__link">f.plotTrendSeason: Understanding trend and seasonality</a></li><li><a href="#bestadstock-adstock-carryover-and-diminishing-returns-effects" class="table-of-contents__link">bestAdstock: Adstock carryover and diminishing returns effects</a></li><li><a href="#fplotbestdecomp-understanding-the-effect-of-baseline-media-variables-trend-and-seasonality-along-time" class="table-of-contents__link">f.plotBestDecomp: Understanding the effect of baseline, media variables trend and seasonality along time</a></li><li><a href="#fplotmapeconverge-understanding-mape-evolution-per-random-search-iteration-and-minutes-spent" class="table-of-contents__link">f.plotMAPEConverge: Understanding MAPE evolution per Random Search iteration and minutes spent</a></li><li><a href="#fplotbestmoddiagnostic-plot-best-model-diagnostics-residual-vs-fitted-qq-plot-and-residual-vs-actual" class="table-of-contents__link">f.plotBestModDiagnostic: plot best model diagnostics: residual vs fitted, QQ plot and residual vs. actual</a></li><li><a href="#fplotchannelroi-understanding-performance-with-spend-and-return-of-investment-charts" class="table-of-contents__link">f.plotChannelROI: Understanding performance with spend and return of investment charts</a></li><li><a href="#fplothypconverge-correlation-and-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error" class="table-of-contents__link">f.plotHypConverge: Correlation and convergence of hyperparameters and MAPE (Mean Absolute Percentage Error)</a></li><li><a href="#fplothyperboundoptim-improved-plot-for-convergence-of-hyperparameters-and-mape-mean-absolute-percentage-error" class="table-of-contents__link">f.plotHyperBoundOptim: Improved plot for convergence of hyperparameters and MAPE (Mean Absolute Percentage Error)</a></li></ul></li><li><a href="#using-the-optimiser" class="table-of-contents__link">Using the optimiser</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebookexperimental/Robyn" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Facebook Open Source Logo" src="/Robyn/img/oss_logo.png"></a></div><div class="footer__copyright">Copyright ¬© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Robyn/styles.8dda7a15.js"></script>
<script src="/Robyn/runtime~main.45b9a820.js"></script>
<script src="/Robyn/main.b745b9ff.js"></script>
<script src="/Robyn/1.494bc5d3.js"></script>
<script src="/Robyn/18.01f78df9.js"></script>
<script src="/Robyn/19.09bfab9f.js"></script>
<script src="/Robyn/935f2afb.08a10c46.js"></script>
<script src="/Robyn/17.5366a0ae.js"></script>
<script src="/Robyn/009561a5.b557d23d.js"></script>
</body>
</html>